<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Today’s Metro Tips – FormFactor Racing</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        max-width: 800px;
        margin: 40px auto;
        padding: 0 16px;
      }
      #locked {
        text-align: center;
        margin-top: 60px;
      }
    </style>
  </head>
  <body>
    <!-- What people see if they DON'T have a valid access link -->
    <div id="locked">
      <h1>Access Required</h1>
      <p>
        This page is only available to customers with a valid FormFactor Racing
        access link.
      </p>
    </div>

    <!-- What paying customers see once their token is verified -->
    <div id="content" style="display: none;">
      <h1>FormFactor Racing – Today’s Metro Tips</h1>
      <div id="tips-container">
        <!-- Paste your weekly tips here each Saturday -->
        <p>Tips will go here…</p>
      </div>
    </div>

    <script>
      async function gate() {
        const params = new URLSearchParams(window.location.search);
        const token = params.get("access");

        if (!token) return;

        try {
          const res = await fetch(
            "/.netlify/functions/check-token?token=" +
              encodeURIComponent(token)
          );
          if (!res.ok) return;

          const data = await res.json();
          if (!data.ok) return;

          // Token is valid → unlock tips
          document.getElementById("locked").style.display = "none";
          document.getElementById("content").style.display = "block";
        } catch (e) {
          console.error(e);
        }
      }

      gate();
    </script>
  </body>
</html>
